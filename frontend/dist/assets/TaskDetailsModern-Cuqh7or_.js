import{r as w,a as it,D as Ot,o as lt,b as dt,d as u,e as t,n as k,t as l,F as Y,p as Z,K as $,B as c,s as L,k as ot,J as Mt,f as At,L as jt,i as Ut,q as Ft,M as Pt,c as Rt,N as Et,h as Bt,O as rt}from"./index-pkYPjNuK.js";import{_ as ct}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Nt={name:"TaskLogsViewer",props:{taskId:{type:String,required:!0},taskData:{type:Object,default:null}},emits:["log-event"],setup(i,{emit:o}){const S=w([]),s=w(!0),O=w(null),{isConnected:V,on:x,off:f}=it(),_=e=>{S.value.push({...e,timestamp:e.timestamp||Date.now()}),S.value.length>200&&(S.value=S.value.slice(-200)),s.value&&$(()=>{h()}),o("log-event",e)},B=()=>{if(!i.taskData)return;const e=S.value.filter(d=>d.type==="system");S.value=[...e];const a=i.taskData;_({type:"task_started",status:"info",message:`🚀 Task execution started on ${a.machine_id}`,timestamp:new Date(a.created_at).toISOString(),details:{machine_id:a.machine_id}}),a.subtasks&&a.subtasks.forEach((d,v)=>{d.attempts&&d.attempts.length>0&&d.attempts.forEach((m,b)=>{var Q;const D=m.exit_code===0;_({type:"command_result",status:D?"success":"error",message:`Command executed: ${m.command}`,timestamp:m.timestamp||new Date().toISOString(),details:{exit_code:m.exit_code,attempt_number:m.attempt_number||b+1,output_length:((Q=m.output)==null?void 0:Q.length)||0,step:v+1,description:d.description}}),m.output&&m.output.trim()&&_({type:"live_output",status:"info",message:`Command output: ${m.output.substring(0,100)}${m.output.length>100?"...":""}`,timestamp:m.timestamp||new Date().toISOString(),details:{stream:"stdout",data_length:m.output.length,full_output:m.output}})})}),a.status==="completed"?_({type:"task_update",status:"completed",message:"✅ Task completed successfully",timestamp:a.completed_at?new Date(a.completed_at).toISOString():new Date().toISOString(),details:{duration:a.completed_at?Math.floor((new Date(a.completed_at)-new Date(a.created_at))/1e3):0}}):a.status==="failed"&&_({type:"task_update",status:"failed",message:"❌ Task execution failed",timestamp:a.completed_at?new Date(a.completed_at).toISOString():new Date().toISOString(),details:{error:a.error_message}})},T=e=>{e.task_id===i.taskId&&_({type:"task_started",status:"info",message:`Task execution started on ${e.machine_id}`,timestamp:new Date().toISOString(),details:{machine_id:e.machine_id}})},y=e=>{if(e.task_id===i.taskId){const a=e.status==="completed",d=e.status==="failed",v=e.status==="running";let m="";a?m="✅ Task completed successfully":d?m="❌ Task execution failed":v?m="⚡ Task is executing...":m=`Task status: ${e.status}`,_({type:"task_update",status:e.status,message:m,timestamp:new Date().toISOString(),details:{subtask_id:e.subtask_id,attempt:e.attempt,validation:e.validation}})}},M=e=>{var a,d,v,m,b;if(e.task_id===i.taskId){const D=((a=e.attempt)==null?void 0:a.exit_code)||e.exit_code,Q=((d=e.attempt)==null?void 0:d.command)||e.command;_({type:"command_result",status:D===0?"success":"error",message:`Command executed: ${Q}`,timestamp:new Date().toISOString(),details:{exit_code:D,attempt_number:(v=e.attempt)==null?void 0:v.attempt_number,output_length:((b=(m=e.attempt)==null?void 0:m.output)==null?void 0:b.length)||0}})}},A=e=>{var a;e.task_id===i.taskId&&_({type:"live_output",status:"info",message:`Command output received (${e.stream})`,timestamp:new Date().toISOString(),details:{stream:e.stream,data_length:((a=e.data)==null?void 0:a.length)||0,subtask_id:e.subtask_id}})},F=e=>{if(e.task_id===i.taskId||e.task_id==="system"){const a=e.level||"info",d=a.toLowerCase();let v="info";d==="error"||d==="critical"?v="error":d==="warning"||d==="warn"?v="warning":d==="debug"&&(v="debug"),_({type:"client_log",status:v,message:e.message||e.data||"Client log entry",timestamp:e.timestamp||new Date().toISOString(),details:{level:a.toUpperCase(),logger:e.logger||"client",machine_id:e.machine_id,context:e.context||{},raw_message:e}})}},P=e=>{if(e.task_id===i.taskId){const a=e.level||"info";let d="info";a==="error"||a==="critical"?d="error":(a==="warning"||a==="warn")&&(d="warning"),_({type:"server_log",status:d,message:e.message||"Server log entry",timestamp:e.timestamp||new Date().toISOString(),details:{level:a.toUpperCase(),source:e.source||"server",context:e.context||{},details:e.details||{}}})}},C=e=>{e.task_id===i.taskId&&_({type:"interactive_prompt",status:"warning",message:"⌨️ Command requires user input",timestamp:new Date().toISOString(),details:{prompt_data:e.data}})},j=e=>{e.task_id===i.taskId&&_({type:"alternative_execution",status:"warning",message:`🔄 Retrying with alternative command (attempt ${e.attempt_number})`,timestamp:new Date().toISOString(),details:{original_command:e.original_command,alternative_command:e.alternative_command,reason:e.reason}})},W=e=>{var a,d,v,m;if(e.type==="client_log"){const b=((a=e.details)==null?void 0:a.logger)||"client",D=((d=e.details)==null?void 0:d.level)||"INFO";return`[${b}] ${D} - ${e.message}`}if(e.type==="server_log"){const b=((v=e.details)==null?void 0:v.source)||"server",D=((m=e.details)==null?void 0:m.level)||"INFO";return`[${b}] ${D} - ${e.message}`}return e.message||"Unknown event"},H=e=>{if(!e.details)return"";const a=[];if(e.details.exit_code!==void 0&&a.push(`Exit code: ${e.details.exit_code}`),e.details.attempt_number&&a.push(`Attempt: ${e.details.attempt_number}`),e.details.step&&a.push(`Step: ${e.details.step}`),e.details.description&&a.push(`Task: ${e.details.description}`),e.details.output_length&&a.push(`Output: ${e.details.output_length} chars`),e.details.machine_id&&a.push(`Machine: ${e.details.machine_id}`),e.details.reason&&a.push(`Reason: ${e.details.reason}`),e.details.duration&&a.push(`Duration: ${e.details.duration}s`),e.type==="client_log"&&(e.details.logger&&e.details.logger!=="client"&&a.push(`Logger: ${e.details.logger}`),e.details.context&&Object.keys(e.details.context).length>0)){const d=Object.entries(e.details.context).map(([v,m])=>`${v}:${m}`).join(", ");a.push(`Context: ${d}`)}if(e.type==="server_log"&&e.details.details&&Object.keys(e.details.details).length>0){const d=Object.entries(e.details.details).slice(0,3).map(([v,m])=>`${v}:${m}`).join(", ");a.push(`Details: ${d}`)}return a.join(" • ")},R=(e,a)=>({task_started:"🚀",task_update:a==="completed"?"✅":a==="failed"?"❌":a==="running"?"⚡":"📋",command_result:a==="success"?"✅":"❌",live_output:"📟",interactive_prompt:"⌨️",alternative_execution:"🔄",client_log:a==="error"?"🔴":a==="warning"?"🟡":a==="debug"?"🔍":"🔵",server_log:a==="error"?"❌":a==="warning"?"⚠️":"🖥️",system:"⚙️"})[e]||"ℹ️",q=(e,a)=>a==="success"||e==="task_started"?"text-green-400":a==="error"||a==="failed"?"text-red-400":a==="warning"||e==="alternative_execution"?"text-yellow-400":a==="running"?"text-blue-400":a==="debug"?"text-purple-400":e==="client_log"?"text-cyan-400":e==="server_log"?"text-indigo-400":"text-gray-300",K=e=>e.status==="success"||e.type==="task_started"?"border-l-2 border-green-500/50":e.status==="error"||e.status==="failed"?"border-l-2 border-red-500/50":e.status==="warning"||e.type==="alternative_execution"?"border-l-2 border-yellow-500/50":e.status==="running"?"border-l-2 border-blue-500/50":e.status==="debug"?"border-l-2 border-purple-500/50":e.type==="client_log"?"border-l-2 border-cyan-500/50":e.type==="server_log"?"border-l-2 border-indigo-500/50":"border-l-2 border-gray-600/50",J=e=>new Date(e).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),N=()=>{S.value=[]},g=()=>{s.value=!s.value,s.value&&h()},h=()=>{O.value&&(O.value.scrollTop=O.value.scrollHeight)};return Ot(()=>i.taskData,e=>{e&&(console.log("📊 Task data updated, repopulating logs..."),B())},{deep:!0,immediate:!0}),lt(()=>{console.log("TaskLogsViewer mounted for task:",i.taskId),_({type:"system",status:"info",message:`📡 Started monitoring task ${i.taskId}`,timestamp:new Date().toISOString(),details:{monitoring:"active"}}),i.taskData&&(console.log("📋 Populating logs from existing task data..."),B()),x("task_started",T),x("task_update",y),x("command_result",M),x("live_output",A),x("interactive_prompt",C),x("waiting_for_input",C),x("alternative_command_triggered",j),x("client_log",F),x("server_log",P),console.log("TaskLogsViewer WebSocket listeners registered")}),dt(()=>{f("task_started",T),f("task_update",y),f("command_result",M),f("live_output",A),f("interactive_prompt",C),f("waiting_for_input",C),f("alternative_command_triggered",j),f("client_log",F),f("server_log",P),console.log("TaskLogsViewer WebSocket listeners cleaned up")}),{logs:S,autoScroll:s,logsContainer:O,isConnected:V,getLogMessage:W,getLogDetails:H,getStatusIcon:R,getMessageClass:q,getLogRowClass:K,formatTime:J,clearLogs:N,toggleAutoScroll:g,scrollToBottom:h}}},Vt={class:"task-logs-viewer bg-gray-900 rounded-lg border border-gray-700"},Gt={class:"flex items-center justify-between p-4 border-b border-gray-700"},zt={class:"flex items-center space-x-3"},Wt={class:"flex items-center space-x-2"},Ht={class:"text-sm text-gray-300 font-medium"},qt={class:"text-xs text-gray-500"},Kt={class:"flex items-center space-x-2"},Jt={ref:"logsContainer",class:"h-80 overflow-y-auto bg-gray-900 font-mono text-sm"},Qt={key:0,class:"flex items-center justify-center h-full text-gray-500"},Xt={key:1,class:"p-4 space-y-2"},Yt={class:"text-xs text-gray-500 font-mono shrink-0 w-20"},Zt={class:"text-base shrink-0 w-6 text-center"},$t={class:"flex-1 min-w-0"},te={key:0,class:"text-xs text-gray-400 mt-1"};function ee(i,o,S,s,O,V){return c(),u("div",Vt,[t("div",Gt,[t("div",zt,[t("div",Wt,[t("div",{class:k(["w-2 h-2 rounded-full animate-pulse",s.isConnected?"bg-green-400":"bg-red-400"])},null,2),t("span",Ht,l(s.isConnected?"Live Updates":"Disconnected"),1)]),t("span",qt,l(s.logs.length)+" events",1)]),t("div",Kt,[t("button",{onClick:o[0]||(o[0]=(...x)=>s.clearLogs&&s.clearLogs(...x)),class:"text-xs px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-gray-300 transition-colors"}," Clear "),t("button",{onClick:o[1]||(o[1]=(...x)=>s.toggleAutoScroll&&s.toggleAutoScroll(...x)),class:k(["text-xs px-3 py-1 rounded text-gray-300 transition-colors",s.autoScroll?"bg-blue-600 hover:bg-blue-700":"bg-gray-700 hover:bg-gray-600"])}," Auto-scroll "+l(s.autoScroll?"ON":"OFF"),3)])]),t("div",Jt,[s.logs.length===0?(c(),u("div",Qt,o[2]||(o[2]=[t("div",{class:"text-center"},[t("div",{class:"text-2xl mb-2"},"📋"),t("p",{class:"text-sm"},"Waiting for task execution logs...")],-1)]))):(c(),u("div",Xt,[(c(!0),u(Y,null,Z(s.logs,(x,f)=>(c(),u("div",{key:f,class:k(["flex items-start space-x-3 p-2 rounded hover:bg-gray-800 transition-colors",s.getLogRowClass(x)])},[t("span",Yt,l(s.formatTime(x.timestamp)),1),t("span",Zt,l(s.getStatusIcon(x.type,x.status)),1),t("div",$t,[t("div",{class:k(["font-medium",s.getMessageClass(x.type,x.status)])},l(s.getLogMessage(x)),3),x.details?(c(),u("div",te,l(s.getLogDetails(x)),1)):L("",!0)])],2))),128))]))],512)])}const se=ct(Nt,[["render",ee],["__scopeId","data-v-bf88aeaf"]]),ne={name:"TaskDetailsModern",components:{TaskLogsViewer:se},setup(){const i=w(null),o=w(null),S=Et(),{isConnected:s,on:O,off:V,sendUserInput:x}=it(),f=w(null),_=w(Date.now()),B=w(Date.now()),T=w(!1),y=w({}),M=w(null),A=w(""),F=w(null),P=w(!1),C=w(null),j=w([]),W=()=>{f.value&&clearInterval(f.value),f.value=setInterval(async()=>{console.log("🔄 Force refreshing ALL task data (1s interval)..."),await R(),i.value&&console.log("📋 Forcing logs refresh for task:",i.value.task_id)},1e3)},H=()=>{f.value&&(clearInterval(f.value),f.value=null)},R=async()=>{try{const r=(await rt.get(`/tasks/${S.params.id}`)).data;i.value&&i.value.ai_summary!==r.ai_summary&&r.ai_summary&&(B.value=Date.now(),T.value=!1),i.value&&i.value.status==="running"&&r.status==="completed"&&!r.ai_summary&&!T.value&&(console.log("🤖 Task completed! Auto-generating AI summary..."),T.value=!0,setTimeout(()=>{console.log("📝 Generating AI summary via API..."),st()},2e3)),i.value=r,_.value=Date.now(),o.value=null}catch(n){console.error("Failed to load task:",n),o.value=n}},q=n=>({pending:"bg-yellow-100 text-yellow-800",running:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800"})[n]||"bg-gray-100 text-gray-800",K=n=>({pending:"⏳",running:"⚡",completed:"✅",failed:"❌"})[n]||"❓",J=n=>({pending:"Pending",running:"Running",completed:"Completed",failed:"Failed"})[n]||"Unknown",N=()=>{var n;return i.value?Math.min(i.value.current_subtask_index+1,((n=i.value.subtasks)==null?void 0:n.length)||0):0},g=()=>{var n,r;return((r=(n=i.value)==null?void 0:n.subtasks)==null?void 0:r.length)||0},h=()=>{var n;return!i.value||!((n=i.value.subtasks)!=null&&n.length)?0:i.value.status==="completed"?100:Math.round(N()/g()*100)},e=()=>{var n;return(n=i.value)!=null&&n.subtasks?i.value.subtasks.filter((r,p)=>{var z,E;if(!((z=r.attempts)!=null&&z.length))return!1;const I=r.attempts[r.attempts.length-1];if((E=I.validation_result)!=null&&E.is_valid)return!0;const G=I.command||r.command||"",U=I.output||"";return D(G)&&I.exit_code!==0&&(["inactive","active","not found","no process","failed","running","stopped","not installed"].some(Dt=>U.toLowerCase().includes(Dt))||U.trim())?!0:I.exit_code===0}).length:0},a=()=>{if(!i.value)return 0;const n=g();if(n===0)return 0;const r=e();return Math.round(r/n*100)},d=n=>n||"Execution Step",v=n=>{const r=b(n);return{pending:"border-gray-200 bg-white",running:"border-blue-300 bg-blue-50",success:"border-green-300 bg-green-50",failed:"border-red-300 bg-red-50"}[r]||"border-gray-200 bg-white"},m=n=>{const r=b(n);return{pending:"bg-gray-200 text-gray-600",running:"bg-blue-500 text-white",success:"bg-green-500 text-white",failed:"bg-red-500 text-white"}[r]||"bg-gray-200 text-gray-600"},b=n=>{var U,z;if(!i.value)return"pending";const r=i.value.subtasks[n];if(!((U=r.attempts)!=null&&U.length))return n<i.value.current_subtask_index?"success":n===i.value.current_subtask_index&&i.value.status==="running"?"running":"pending";const p=r.attempts[r.attempts.length-1];if((z=p.validation_result)!=null&&z.is_valid)return"success";const I=p.command||r.command||"",G=p.output||"";return D(I)&&p.exit_code!==0&&(["inactive","active","not found","no process","failed","running","stopped","not installed"].some(at=>G.toLowerCase().includes(at))||G.trim())||p.exit_code===0?"success":"failed"},D=n=>{const r=["which","systemctl status","systemctl is-active","ps aux | grep","dpkg -s","dpkg -l","ss -tulnp","netstat","nginx -v","docker --version","apt list","yum list","rpm -q","service","pgrep","pidof"],p=n.toLowerCase();return r.some(I=>p.includes(I))},Q=n=>{const r=b(n);return{pending:"⏳",running:"⚡",success:"✅",failed:"❌"}[r]||"❓"},tt=n=>{const r=b(n);return{pending:"Pending",running:"Running",success:"Success",failed:"Failed"}[r]||"Unknown"},ut=n=>{const r=b(n);return{pending:"text-gray-600",running:"text-blue-600",success:"text-green-600",failed:"text-red-600"}[r]||"text-gray-600"},mt=n=>{const r=b(n);return{pending:"bg-gray-200 text-gray-600",running:"bg-blue-500 text-white shadow-lg animate-pulse",success:"bg-green-500 text-white shadow-lg",failed:"bg-red-500 text-white shadow-lg"}[r]||"bg-gray-200 text-gray-600"},gt=n=>{const r=b(n);return{pending:"bg-gray-100 text-gray-600",running:"bg-blue-100 text-blue-700",success:"bg-green-100 text-green-700",failed:"bg-red-100 text-red-700"}[r]||"bg-gray-100 text-gray-600"},pt=n=>n?n.length>50?n.substring(0,50)+"...":n:"Execution Step",xt=n=>n?n.length>60?n.substring(0,60)+"...":n:"No command",ft=async n=>{try{await navigator.clipboard.writeText(n),console.log("✅ Copied to clipboard:",n)}catch(r){console.error("❌ Failed to copy to clipboard:",r)}},_t=n=>n?new Date(n).toLocaleString():"Unknown",vt=n=>{const r=Math.floor((Date.now()-n)/1e3);if(r<5)return"just now";if(r<60)return`${r}s ago`;const p=Math.floor(r/60);return p<60?`${p}m ago`:`${Math.floor(p/60)}h ago`},yt=()=>{var U;if(!((U=i.value)!=null&&U.created_at))return"Unknown";const n=new Date(i.value.created_at),r=i.value.completed_at?new Date(i.value.completed_at):new Date,p=Math.floor((r-n)/1e3);if(p<60)return`${p}s`;if(p<3600)return`${Math.floor(p/60)}m ${p%60}s`;const I=Math.floor(p/3600),G=Math.floor(p%3600/60);return`${I}h ${G}m`},ht=()=>i.value?i.value.status==="completed"?"✅ Completed successfully":i.value.status==="failed"?"❌ Execution failed":i.value.status==="running"?"⚡ Executing...":"⏳ Pending execution":"Loading...",bt=()=>{if(!i.value||i.value.status!=="running")return null;const n=N()-1,r=g();if(n===0)return null;const p=new Date(i.value.created_at),U=(new Date-p)/n,z=r-n,E=U*z;return E<6e4?`~${Math.round(E/1e3)}s remaining`:E<36e5?`~${Math.round(E/6e4)}m remaining`:`~${Math.round(E/36e5)}h remaining`},kt=Rt(()=>Object.keys(y.value).length>0&&Object.values(y.value).some(n=>n.trim())),wt=()=>Object.values(y.value).join(""),St=()=>{y.value={}},et=()=>{$(()=>{M.value&&(M.value.scrollTop=M.value.scrollHeight)})},Ct=()=>{if(!A.value.trim()||!C.value)return;const n=A.value.trim();y.value[C.value]&&(y.value[C.value]+=`
> ${n}
`),x(i.value.task_id,i.value.machine_id,n),A.value="",P.value=!1,C.value=null},It=n=>{const r=j.value.indexOf(n);r>=0?j.value.splice(r,1):j.value.push(n)},st=async()=>{if(!(!i.value||i.value.status!=="completed"))try{T.value=!0,await rt.post(`/tasks/${i.value.task_id}/generate-summary`)}catch(n){console.error("Failed to generate AI summary:",n),T.value=!1}},nt=n=>{if(n.task_id===S.params.id){const r=n.subtask_id||"default";y.value[r]||(y.value[r]=""),y.value[r]+=n.data,et()}},X=n=>{if(n.task_id===S.params.id){const r=n.subtask_id||"default";C.value=r,P.value=!0,y.value[r]||(y.value[r]=""),y.value[r]+=`
${n.data}`,$(()=>{F.value&&F.value.focus()})}},Tt=n=>{console.log("📋 TaskDetails received log event:",n),(n.type==="task_update"||n.type==="command_result")&&(console.log("🔄 Important log event detected, refreshing task data..."),setTimeout(()=>{R()},100)),(n.level==="critical"||n.level==="error")&&console.warn("⚠️ Critical system event:",n.message)};return lt(async()=>{console.log("🚀 TaskDetailsModern mounted for task:",S.params.id),console.log("🔌 WebSocket connected?",s.value),await R(),console.log("▶️ Starting 1-second force auto-refresh for ALL task data"),W(),O("live_output",nt),O("interactive_prompt",X),O("waiting_for_input",X)}),dt(()=>{H(),V("live_output",nt),V("interactive_prompt",X),V("waiting_for_input",X)}),{task:i,error:o,lastRefresh:_,lastAISummaryUpdate:B,isGeneratingAISummary:T,isConnected:s,hasLiveOutput:kt,liveOutputs:y,terminalContainer:M,getLiveOutputText:wt,clearLiveOutput:St,scrollToBottom:et,userInput:A,userInputField:F,isWaitingForInput:P,sendUserInput:Ct,expandedMethods:j,toggleMethodDetails:It,getStatusClasses:q,getStatusIcon:K,getStatusText:J,getCurrentStep:N,getTotalSteps:g,getProgressPercentage:h,getSuccessfulSteps:e,getSuccessRate:a,getProgressStatus:ht,getETA:bt,getStepTitle:d,getStepCardClasses:v,getStepNumberClasses:m,getStepStatus:b,getStepStatusIcon:Q,getStepStatusText:tt,getStepStatusTextClasses:ut,getCompactStepClasses:mt,getCompactStatusBadge:gt,getCompactStepTitle:pt,getCompactCommand:xt,copyToClipboard:ft,formatDate:_t,formatLastUpdate:vt,getExecutionDuration:yt,loadTask:R,generateAISummary:st,handleLogEvent:Tt}}},ae={class:"min-h-screen bg-gray-50"},oe={class:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-10"},re={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},ie={class:"py-4"},le={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4"},de={class:"flex-1 min-w-0"},ce={class:"text-2xl font-bold text-gray-900 truncate"},ue={class:"mt-2 flex flex-wrap items-center gap-3"},me={class:"flex items-center gap-2"},ge={class:"mr-1"},pe={class:"flex items-center gap-2"},xe={class:"flex flex-col sm:flex-row sm:items-center gap-4 text-sm text-gray-600"},fe={class:"ml-1 font-mono text-xs bg-gray-100 px-2 py-1 rounded"},_e={class:"ml-1 font-mono bg-blue-50 text-blue-700 px-2 py-1 rounded text-xs"},ve={key:0,class:"mt-4"},ye={class:"flex justify-between items-center text-sm text-gray-600 mb-2"},he={class:"font-semibold text-primary-600"},be={class:"w-full bg-gray-200 rounded-full h-2 overflow-hidden"},ke={class:"mt-2 flex justify-between items-center text-xs text-gray-500"},we={key:0},Se={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},Ce={class:"grid grid-cols-1 xl:grid-cols-3 lg:grid-cols-2 gap-6"},Ie={class:"xl:col-span-2 lg:col-span-1 space-y-6"},Te={key:0,class:"bg-white shadow rounded-lg"},Le={class:"px-4 py-5 sm:p-6"},De={class:"flex justify-between items-start mb-4"},Oe={class:"flex items-center"},Me={class:"ml-3"},Ae={class:"mt-1 text-sm text-gray-500"},je={class:"flex items-center space-x-3"},Ue={class:"text-xs text-gray-400"},Fe={class:"mt-4"},Pe={key:0,class:"flex items-center space-x-3 text-gray-600"},Re={key:1,class:"prose prose-sm max-w-none text-gray-700 bg-gray-50 p-4 rounded-lg"},Ee={key:2,class:"text-center py-8 text-gray-500"},Be={class:"bg-white shadow rounded-lg"},Ne={class:"px-4 py-5 sm:p-6"},Ve={class:"flex justify-between items-center mb-4"},Ge={class:"text-xs text-gray-400"},ze={class:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2 lg:grid-cols-3"},We={class:"mt-1 text-sm text-gray-900"},He={class:"bg-white shadow rounded-lg"},qe={class:"px-4 py-5 sm:p-6"},Ke={key:1,class:"bg-white shadow rounded-lg"},Je={class:"px-4 py-5 sm:p-6"},Qe={class:"flex justify-between items-center mb-4"},Xe={class:"flex space-x-2"},Ye={class:"bg-gray-900 rounded-lg p-4 max-h-96 overflow-y-auto font-mono text-sm",ref:"terminalContainer"},Ze={class:"text-green-400 whitespace-pre-wrap"},$e={key:0,class:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"},ts={class:"flex space-x-2"},es=["disabled"],ss={class:"space-y-6"},ns={class:"bg-white shadow-sm rounded-xl border border-gray-100 overflow-hidden"},as={class:"bg-gradient-to-r from-blue-50 to-indigo-50 px-4 py-4 border-b border-gray-100"},os={class:"flex items-center justify-between"},rs={class:"flex items-center space-x-3"},is={class:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center"},ls={class:"text-blue-600 font-semibold text-sm"},ds={class:"text-sm text-gray-600"},cs={class:"flex items-center space-x-2"},us={class:"relative w-12 h-12"},ms={class:"w-12 h-12 transform -rotate-90",viewBox:"0 0 36 36"},gs=["stroke-dasharray"],ps={class:"absolute inset-0 flex items-center justify-center"},xs={class:"text-xs font-semibold text-gray-700"},fs={class:"divide-y divide-gray-100"},_s={class:"group hover:bg-gray-50 transition-colors duration-200"},vs={class:"flex items-center px-3 sm:px-4 py-3"},ys={class:"flex-shrink-0 mr-2 sm:mr-3"},hs={key:0},bs={key:1},ks={key:2,class:"animate-spin"},ws={key:3},Ss={class:"flex-1 min-w-0 mr-2 sm:mr-3"},Cs={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},Is={class:"text-sm font-medium text-gray-900 truncate group-hover:text-gray-700 mb-1 sm:mb-0"},Ts={class:"hidden sm:inline"},Ls={class:"flex items-center space-x-2 text-xs"},Ds={class:"mt-1 sm:mt-2"},Os={class:"text-xs text-gray-600 bg-gray-100 px-2 py-1 rounded font-mono break-all"},Ms=["onClick"],As={key:0,class:"bg-gray-50 border-t border-gray-100 animate-in slide-in-from-top duration-200"},js={class:"px-3 sm:px-4 py-4 space-y-3 sm:space-y-4"},Us={class:"bg-white rounded-lg p-3 border border-gray-200"},Fs={class:"text-sm text-gray-700"},Ps={class:"bg-gray-900 rounded-lg p-3"},Rs={class:"flex items-center justify-between mb-2"},Es=["onClick"],Bs={class:"text-green-400 text-sm font-mono break-all"},Ns={class:"bg-blue-50 rounded-lg p-3 border border-blue-200"},Vs={class:"text-sm text-blue-800"},Gs={key:0,class:"space-y-3"},zs={class:"text-xs font-semibold text-gray-700 uppercase tracking-wide flex items-center space-x-2"},Ws={class:"bg-gray-200 text-gray-700 px-2 py-0.5 rounded-full text-xs"},Hs={class:"space-y-2"},qs={class:"flex items-center space-x-2"},Ks={class:"flex items-center space-x-2"},Js={key:0,class:"bg-gray-900 p-3 max-h-64 overflow-y-auto"},Qs={class:"text-green-400 text-xs whitespace-pre-wrap font-mono"},Xs={key:1,class:"px-3 py-2 text-xs text-gray-500 italic"},Ys={key:0,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-6"},Zs={class:"bg-red-50 border border-red-200 rounded-md p-4"},$s={class:"flex"},tn={class:"ml-3"},en={class:"mt-2 text-sm text-red-700"},sn={key:1,class:"flex items-center justify-center min-h-64"},nn={key:2,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},an={class:"text-center py-12"},on={class:"mt-2 text-sm text-gray-500"},rn={class:"mt-6"};function ln(i,o,S,s,O,V){var f,_,B,T,y,M,A,F,P,C,j,W,H,R,q,K,J,N;const x=Bt("TaskLogsViewer");return c(),u("div",ae,[t("div",oe,[t("div",re,[t("div",ie,[t("div",le,[t("div",de,[t("h1",ce,l(((f=s.task)==null?void 0:f.original_prompt)||"Loading task..."),1),t("div",ue,[t("div",me,[t("span",{class:k(["inline-flex items-center px-3 py-1 rounded-full text-sm font-medium",s.getStatusClasses((_=s.task)==null?void 0:_.status)])},[t("span",ge,l(s.getStatusIcon((B=s.task)==null?void 0:B.status)),1),ot(" "+l(s.getStatusText((T=s.task)==null?void 0:T.status)),1)],2)]),t("div",pe,[t("div",{class:k(["w-2 h-2 rounded-full",s.isConnected?"bg-green-400 animate-pulse":"bg-red-400"])},null,2),o[7]||(o[7]=t("span",{class:"text-sm text-gray-600"}," Auto-refreshing every 1 second ",-1))])])]),t("div",xe,[t("div",null,[o[8]||(o[8]=t("span",{class:"font-medium"},"Task ID:",-1)),t("span",fe,l((y=s.task)==null?void 0:y.task_id),1)]),t("div",null,[o[9]||(o[9]=t("span",{class:"font-medium"},"Machine:",-1)),t("span",_e,l(((M=s.task)==null?void 0:M.machine_id)||"Unknown"),1)])])]),s.task?(c(),u("div",ve,[t("div",ye,[t("span",null,"Progress: "+l(s.getCurrentStep())+"/"+l(s.getTotalSteps())+" steps",1),t("span",he,l(s.getProgressPercentage())+"%",1)]),t("div",be,[t("div",{class:"bg-gradient-to-r from-primary-500 to-primary-600 h-2 rounded-full transition-all duration-500",style:Mt({width:s.getProgressPercentage()+"%"})},null,4)]),t("div",ke,[t("span",null,l(s.getProgressStatus()),1),s.getETA()?(c(),u("span",we,l(s.getETA()),1)):L("",!0)])])):L("",!0)])])]),t("div",Se,[t("div",Ce,[t("div",Ie,[(A=s.task)!=null&&A.ai_summary||s.isGeneratingAISummary||((F=s.task)==null?void 0:F.status)==="completed"&&!((P=s.task)!=null&&P.ai_summary)?(c(),u("div",Te,[t("div",Le,[t("div",De,[t("div",Oe,[o[11]||(o[11]=t("div",{class:"flex-shrink-0"},[t("span",{class:"text-2xl"},"🤖")],-1)),t("div",Me,[o[10]||(o[10]=t("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"AI Analysis",-1)),t("p",Ae,l(s.isGeneratingAISummary?"Analyzing task execution...":"Intelligent task summary"),1)])]),t("div",je,[((C=s.task)==null?void 0:C.status)==="completed"&&!s.isGeneratingAISummary?(c(),u("button",{key:0,onClick:o[0]||(o[0]=(...g)=>s.generateAISummary&&s.generateAISummary(...g)),class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-primary-700 bg-primary-100 hover:bg-primary-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors"},l((j=s.task)!=null&&j.ai_summary?"Regenerate":"Generate Summary"),1)):L("",!0),t("span",Ue,l(s.isGeneratingAISummary?"Generating...":s.formatLastUpdate(s.lastAISummaryUpdate)),1)])]),t("div",Fe,[s.isGeneratingAISummary?(c(),u("div",Pe,o[12]||(o[12]=[At('<div class="flex space-x-1"><div class="w-2 h-2 bg-primary-500 rounded-full animate-bounce"></div><div class="w-2 h-2 bg-primary-500 rounded-full animate-bounce" style="animation-delay:0.1s;"></div><div class="w-2 h-2 bg-primary-500 rounded-full animate-bounce" style="animation-delay:0.2s;"></div></div><span class="text-sm italic">Analyzing execution results...</span>',2)]))):(W=s.task)!=null&&W.ai_summary?(c(),u("div",Re,l(s.task.ai_summary),1)):(c(),u("div",Ee,o[13]||(o[13]=[t("p",null,'AI analysis not yet available. Click "Generate Summary" to analyze this completed task.',-1)])))])])])):L("",!0),t("div",Be,[t("div",Ne,[t("div",Ve,[o[14]||(o[14]=t("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Task Information",-1)),t("span",Ge,"Updated "+l(s.formatLastUpdate(s.lastRefresh)),1)]),t("dl",ze,[t("div",null,[o[15]||(o[15]=t("dt",{class:"text-sm font-medium text-gray-500"},"Created",-1)),t("dd",We,l(s.formatDate((H=s.task)==null?void 0:H.created_at)),1)]),t("div",null,[o[16]||(o[16]=t("dt",{class:"text-sm font-medium text-gray-500"},"Duration",-1)),t("dd",{class:k(["mt-1 text-sm text-gray-900",{"text-primary-600 font-semibold":((R=s.task)==null?void 0:R.status)==="running"}])},l(s.getExecutionDuration()),3)]),t("div",null,[o[17]||(o[17]=t("dt",{class:"text-sm font-medium text-gray-500"},"Success Rate",-1)),t("dd",{class:k(["mt-1 text-sm font-semibold",s.getSuccessRate()>80?"text-green-600":s.getSuccessRate()>50?"text-yellow-600":"text-red-600"])},l(s.getSuccessRate())+"% ",3)])])])]),t("div",He,[t("div",qe,[o[18]||(o[18]=t("div",{class:"flex items-center mb-4"},[t("span",{class:"text-xl mr-3"},"📋"),t("div",null,[t("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Execution Logs"),t("p",{class:"text-sm text-gray-500 mt-1"},"Real-time task execution events and status updates")])],-1)),(c(),jt(x,{key:`logs-${(q=s.task)==null?void 0:q.task_id}-${s.lastRefresh}`,"task-id":((K=s.task)==null?void 0:K.task_id)||i.$route.params.id,"task-data":s.task,onLogEvent:s.handleLogEvent},null,8,["task-id","task-data","onLogEvent"]))])]),s.hasLiveOutput?(c(),u("div",Ke,[t("div",Je,[t("div",Qe,[o[19]||(o[19]=t("div",{class:"flex items-center"},[t("span",{class:"text-xl mr-2"},"📟"),t("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Live Output")],-1)),t("div",Xe,[t("button",{onClick:o[1]||(o[1]=(...g)=>s.clearLiveOutput&&s.clearLiveOutput(...g)),class:"text-xs px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded text-gray-700 transition-colors"}," Clear "),t("button",{onClick:o[2]||(o[2]=(...g)=>s.scrollToBottom&&s.scrollToBottom(...g)),class:"text-xs px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded text-gray-700 transition-colors"}," Bottom ")])]),t("div",Ye,[t("pre",Ze,l(s.getLiveOutputText()),1)],512),s.isWaitingForInput?(c(),u("div",$e,[o[20]||(o[20]=t("div",{class:"flex items-center mb-3 text-blue-700"},[t("span",{class:"mr-2"},"⌨️"),t("span",{class:"font-medium"},"Command waiting for input...")],-1)),t("div",ts,[Ut(t("input",{"onUpdate:modelValue":o[3]||(o[3]=g=>s.userInput=g),onKeypress:o[4]||(o[4]=Pt((...g)=>s.sendUserInput&&s.sendUserInput(...g),["enter"])),placeholder:"Type your response and press Enter...",class:"flex-1 px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm",ref:"userInputField",autocomplete:"off"},null,544),[[Ft,s.userInput]]),t("button",{onClick:o[5]||(o[5]=(...g)=>s.sendUserInput&&s.sendUserInput(...g)),disabled:!s.userInput.trim(),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"}," Send ",8,es)])])):L("",!0)])])):L("",!0)]),t("div",ss,[t("div",ns,[t("div",as,[t("div",os,[t("div",rs,[t("div",is,[t("span",ls,l(s.getTotalSteps()),1)]),t("div",null,[o[21]||(o[21]=t("h3",{class:"text-lg font-semibold text-gray-900"},"Execution Steps",-1)),t("p",ds,l(s.getSuccessfulSteps())+" of "+l(s.getTotalSteps())+" completed",1)])]),t("div",cs,[t("div",us,[(c(),u("svg",ms,[o[22]||(o[22]=t("path",{class:"text-gray-200",stroke:"currentColor","stroke-width":"3",fill:"none",d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,-1)),t("path",{class:"text-blue-600",stroke:"currentColor","stroke-width":"3",fill:"none","stroke-linecap":"round","stroke-dasharray":`${s.getProgressPercentage()}, 100`,d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,8,gs)])),t("div",ps,[t("span",xs,l(s.getProgressPercentage())+"%",1)])])])])]),t("div",fs,[(c(!0),u(Y,null,Z(((J=s.task)==null?void 0:J.subtasks)||[],(g,h)=>{var e;return c(),u("div",{key:h,class:"relative"},[t("div",_s,[t("div",vs,[t("div",ys,[t("div",{class:k(["w-6 h-6 sm:w-7 sm:h-7 rounded-full flex items-center justify-center text-xs font-bold transition-all duration-200",s.getCompactStepClasses(h)])},[s.getStepStatus(h)==="success"?(c(),u("span",hs,"✓")):s.getStepStatus(h)==="failed"?(c(),u("span",bs,"✗")):s.getStepStatus(h)==="running"?(c(),u("span",ks,"⚡")):(c(),u("span",ws,l(h+1),1))],2)]),t("div",Ss,[t("div",Cs,[t("h4",Is,[t("span",Ts,"Step "+l(h+1)+": ",1),ot(l(s.getCompactStepTitle(g.description)),1)]),t("div",Ls,[t("span",{class:k(["px-2 py-1 rounded-full font-medium",s.getCompactStatusBadge(h)])},l(s.getStepStatusText(h)),3)])]),t("div",Ds,[t("code",Os,l(s.getCompactCommand(g.command)),1)])]),t("button",{onClick:a=>s.toggleMethodDetails(h),class:"flex-shrink-0 w-8 h-8 rounded-full hover:bg-gray-200 flex items-center justify-center transition-colors duration-200 group-hover:bg-gray-200"},[(c(),u("svg",{class:k(["w-4 h-4 text-gray-500 transform transition-transform duration-200",s.expandedMethods.includes(h)?"rotate-180":""])},o[23]||(o[23]=[t("path",{fill:"currentColor",d:"M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"},null,-1)]),2))],8,Ms)])]),s.expandedMethods.includes(h)?(c(),u("div",As,[t("div",js,[t("div",Us,[o[24]||(o[24]=t("h5",{class:"text-xs font-semibold text-gray-700 uppercase tracking-wide mb-2"},"Task Description",-1)),t("p",Fs,l(g.description),1)]),t("div",Ps,[t("div",Rs,[o[26]||(o[26]=t("h5",{class:"text-xs font-semibold text-gray-300 uppercase tracking-wide"},"Command",-1)),t("button",{onClick:a=>s.copyToClipboard(g.command),class:"text-xs text-gray-400 hover:text-gray-200 flex items-center space-x-1"},o[25]||(o[25]=[t("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),t("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"})],-1),t("span",null,"Copy",-1)]),8,Es)]),t("code",Bs,l(g.command),1)]),t("div",Ns,[o[27]||(o[27]=t("h5",{class:"text-xs font-semibold text-blue-700 uppercase tracking-wide mb-2"},"Expected Output",-1)),t("p",Vs,l(g.expected_output||"No expected output defined"),1)]),(e=g.attempts)!=null&&e.length?(c(),u("div",Gs,[t("h5",zs,[o[28]||(o[28]=t("span",null,"Execution History",-1)),t("span",Ws,l(g.attempts.length)+" attempts",1)]),t("div",Hs,[(c(!0),u(Y,null,Z(g.attempts,(a,d)=>(c(),u("div",{key:d,class:k(["border rounded-lg overflow-hidden",a.exit_code===0?"border-green-200 bg-green-50":"border-red-200 bg-red-50"])},[t("div",{class:k(["px-3 py-2 flex justify-between items-center",a.exit_code===0?"bg-green-100":"bg-red-100"])},[t("div",qs,[t("span",{class:k(["text-xs font-medium",a.exit_code===0?"text-green-800":"text-red-800"])}," Attempt "+l(a.attempt_number||d+1),3),t("span",{class:k(["text-xs",a.exit_code===0?"text-green-600":"text-red-600"])},l(a.timestamp?new Date(a.timestamp).toLocaleTimeString():"No timestamp"),3)]),t("div",Ks,[t("span",{class:k(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",a.exit_code===0?"bg-green-200 text-green-800":"bg-red-200 text-red-800"])},l(a.exit_code===0?"✓ Success":"✗ Failed"),3),t("span",{class:k(["text-xs font-mono px-2 py-1 rounded",a.exit_code===0?"bg-green-200 text-green-800":"bg-red-200 text-red-800"])},l(a.exit_code),3)])],2),a.output&&a.output.trim()?(c(),u("div",Js,[t("pre",Qs,l(a.output),1)])):(c(),u("div",Xs," No output captured "))],2))),128))])])):L("",!0)])])):L("",!0)])}),128))])])])])]),(N=s.task)!=null&&N.error_message?(c(),u("div",Ys,[t("div",Zs,[t("div",$s,[o[30]||(o[30]=t("div",{class:"flex-shrink-0"},[t("span",{class:"text-red-400 text-xl"},"⚠️")],-1)),t("div",tn,[o[29]||(o[29]=t("h3",{class:"text-sm font-medium text-red-800"},"Execution Error",-1)),t("div",en,l(s.task.error_message),1)])])])])):L("",!0),!s.task&&!s.error?(c(),u("div",sn,o[31]||(o[31]=[t("div",{class:"text-center"},[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),t("p",{class:"mt-4 text-gray-600"},"Loading task details...")],-1)]))):L("",!0),s.error?(c(),u("div",nn,[t("div",an,[o[32]||(o[32]=t("span",{class:"text-6xl"},"❌",-1)),o[33]||(o[33]=t("h3",{class:"mt-4 text-lg font-medium text-gray-900"},"Failed to load task details",-1)),t("p",on,l(s.error.message||"Unknown error occurred"),1),t("div",rn,[t("button",{onClick:o[6]||(o[6]=(...g)=>s.loadTask&&s.loadTask(...g)),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Try Again ")])])])):L("",!0)])}const un=ct(ne,[["render",ln]]);export{un as default};
