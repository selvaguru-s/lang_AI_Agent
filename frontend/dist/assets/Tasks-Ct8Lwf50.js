import{d,e as s,s as I,n as f,t as n,k as m,F as D,p as S,l as b,i as g,q as w,r as p,u as V,a as N,o as B,b as F,y as C,A as U,h as q,B as c,J as A,g as z,w as E}from"./index-pkYPjNuK.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const P={name:"Tasks",setup(){const r=p([]),t=p(!1),l=p({prompt:"",machine_id:""});V();const o=U(),{isConnected:k,on:u,off:i}=N(),e=async()=>{try{const a=await C.list();r.value=a.data}catch(a){console.error("Failed to load tasks:",a)}},T=async()=>{try{const a=await C.create(l.value.prompt,l.value.machine_id);t.value=!1,l.value={prompt:"",machine_id:""},o.push(`/tasks/${a.data.task_id}`)}catch(a){console.error("Failed to create task:",a)}},x=a=>new Date(a).toLocaleString(),y=a=>({pending:"⏳",running:"⚡",completed:"✅",failed:"❌"})[a]||"❓",h=a=>{const _=r.value.findIndex(M=>M.task_id===a.task_id);_!==-1?(r.value[_].status=a.status,(a.status==="completed"||a.status==="failed")&&e()):e()},v=a=>{e()};return B(()=>{e(),u("task_update",h),u("task_started",v);const a=setInterval(()=>{console.log("🔄 Tasks page auto-refreshing..."),e()},5e3);F(()=>{clearInterval(a),i("task_update",h),i("task_started",v)})}),{tasks:r,showCreateModal:t,newTask:l,createTask:T,formatDate:x,getStatusIcon:y,isConnected:k}}},R={class:"tasks-modern"},J={class:"header-section"},W={class:"header-card"},j={class:"header-content"},G={class:"header-left"},H={class:"connection-status"},K={class:"status-text"},O={class:"tasks-grid"},Q={class:"task-card-header"},X={class:"task-info"},Y={class:"task-title"},Z={class:"task-meta"},$={class:"machine-badge"},ss={class:"date-badge"},ts={class:"status-icon"},es={class:"status-text"},as={class:"progress-section"},os={class:"progress-info"},ns={class:"percentage"},rs={class:"progress-bar"},ls={class:"task-actions"},is={class:"modern-modal"},ds={class:"modal-header"},cs={class:"form-group"},us={class:"form-group"},_s={class:"form-actions"};function ms(r,t,l,o,k,u){const i=q("router-link");return c(),d("div",R,[s("div",J,[s("div",W,[s("div",j,[s("div",G,[t[7]||(t[7]=s("h1",null,"Task Management",-1)),s("div",H,[s("span",{class:f(["status-dot",o.isConnected?"online":"offline"])},null,2),s("span",K,n(o.isConnected?"Real-time updates active":"Connecting..."),1)])]),s("button",{onClick:t[0]||(t[0]=e=>o.showCreateModal=!0),class:"create-btn"},t[8]||(t[8]=[s("span",{class:"btn-icon"},"✨",-1),m(" Create New Task ",-1)]))])])]),s("div",O,[(c(!0),d(D,null,S(o.tasks,e=>(c(),d("div",{key:e.task_id,class:"modern-task-card"},[s("div",Q,[s("div",X,[s("h3",Y,n(e.original_prompt),1),s("div",Z,[s("span",$,n(e.machine_id),1),s("span",ss,n(o.formatDate(e.created_at)),1)])]),s("div",{class:f(["status-badge",`status-${e.status}`])},[s("span",ts,n(o.getStatusIcon(e.status)),1),s("span",es,n(e.status),1)],2)]),s("div",as,[s("div",os,[s("span",null,"Progress: "+n(e.current_subtask_index+1)+"/"+n(e.subtasks.length),1),s("span",ns,n(Math.round((e.current_subtask_index+1)/e.subtasks.length*100))+"%",1)]),s("div",rs,[s("div",{class:"progress-fill",style:A({width:Math.round((e.current_subtask_index+1)/e.subtasks.length*100)+"%"})},null,4)])]),s("div",ls,[z(i,{to:`/tasks/${e.task_id}`,class:"view-details-btn"},{default:E(()=>t[9]||(t[9]=[s("span",{class:"btn-icon"},"👁️",-1),m(" View Details ",-1)])),_:2,__:[9]},1032,["to"])])]))),128))]),o.showCreateModal?(c(),d("div",{key:0,class:"modal-overlay",onClick:t[6]||(t[6]=b(e=>o.showCreateModal=!1,["self"]))},[s("div",is,[s("div",ds,[t[10]||(t[10]=s("h2",null,"✨ Create New Task",-1)),s("button",{onClick:t[1]||(t[1]=e=>o.showCreateModal=!1),class:"close-btn"},"×")]),s("form",{onSubmit:t[5]||(t[5]=b((...e)=>o.createTask&&o.createTask(...e),["prevent"])),class:"modal-form"},[s("div",cs,[t[11]||(t[11]=s("label",{class:"form-label"},"Task Description:",-1)),g(s("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>o.newTask.prompt=e),required:"",rows:"4",class:"form-textarea",placeholder:"Describe what you want to accomplish..."},null,512),[[w,o.newTask.prompt]])]),s("div",us,[t[12]||(t[12]=s("label",{class:"form-label"},"Machine ID:",-1)),g(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>o.newTask.machine_id=e),required:"",class:"form-input",placeholder:"Enter target machine ID"},null,512),[[w,o.newTask.machine_id]])]),s("div",_s,[s("button",{type:"button",onClick:t[4]||(t[4]=e=>o.showCreateModal=!1),class:"cancel-btn"},"Cancel"),t[13]||(t[13]=s("button",{type:"submit",class:"submit-btn"},[s("span",{class:"btn-icon"},"🚀"),m(" Create Task ")],-1))])],32)])])):I("",!0)])}const hs=L(P,[["render",ms],["__scopeId","data-v-d8dbd41b"]]);export{hs as default};
